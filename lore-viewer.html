<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Southia Lore Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 500px;
        }

        .lore-section {
            display: none;
        }

        .lore-section.active {
            display: block;
        }

        .lore-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s ease;
        }

        .lore-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .lore-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .lore-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .lore-id {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .lore-content {
            margin-bottom: 15px;
        }

        .lore-content h3 {
            color: #34495e;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .lore-content p {
            margin-bottom: 10px;
            color: #555;
        }

        .factions, .notables, .adventure-hooks {
            margin-top: 15px;
        }

        .faction, .notable, .hook {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
        }

        .faction h4, .notable h4, .hook h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .faction p, .notable p, .hook p {
            margin-bottom: 5px;
            color: #666;
        }

        .secret {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 8px;
            margin-top: 8px;
            font-style: italic;
            color: #856404;
        }

        .metadata {
            background: #e9ecef;
            border-radius: 5px;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #999;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-tab {
                width: 200px;
            }
            
            .lore-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∞ Southia Lore Viewer</h1>
            <p>Explore the generated lore for your world</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('burgs')">üèòÔ∏è Burgs</button>
            <button class="nav-tab" onclick="showSection('states')">üèõÔ∏è States</button>
            <button class="nav-tab" onclick="showSection('provinces')">üó∫Ô∏è Provinces</button>
        </div>

        <div class="content">
            <div id="burgs" class="lore-section active">
                <div class="loading">Loading burg lore...</div>
            </div>

            <div id="states" class="lore-section">
                <div class="loading">Loading state lore...</div>
            </div>

            <div id="provinces" class="lore-section">
                <div class="empty-state">
                    <h3>No Province Lore Yet</h3>
                    <p>Province lore generation hasn't been implemented yet.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function lettermarkShield(name, color = "#6b7280") {
            const initials = name.split(/\s+/).slice(0,2).map(s=>s[0]?.toUpperCase()).join("") || "K";
            // Simple deterministic accent from name
            const hue = (Array.from(name).reduce((a,c)=>a+c.charCodeAt(0),0) % 360);
            const accent = `hsl(${hue}, 60%, 45%)`;
            const svg = `
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="96" viewBox="0 0 80 96">
                <defs>
                    <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
                        <stop offset="0%" stop-color="${color}" stop-opacity="0.95"/>
                        <stop offset="100%" stop-color="${accent}" stop-opacity="0.95"/>
                    </linearGradient>
                </defs>
                <path d="M10 5 h60 a5 5 0 0 1 5 5 v40 a40 40 0 0 1 -35 39 a40 40 0 0 1 -35 -39 v-40 a5 5 0 0 1 5 -5 z" fill="url(#g)" stroke="#111827" stroke-width="2"/>
                <text x="40" y="56" font-family="ui-sans-serif, system-ui" font-size="28" fill="white" text-anchor="middle" font-weight="700">${initials}</text>
            </svg>`;
            return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        }

        let loreData = {
            burgs: [],
            states: [],
            provinces: []
        };

        async function loadLoreFiles() {
            try {
                // Load burg lore files
                const burgFiles = await fetchLoreFiles('burg');
                loreData.burgs = burgFiles;
                renderLoreSection('burgs', burgFiles);

                // Load state lore files
                const stateFiles = await fetchLoreFiles('state');
                loreData.states = stateFiles;
                renderLoreSection('states', stateFiles);

            } catch (error) {
                console.error('Error loading lore files:', error);
                document.getElementById('burgs').innerHTML = '<div class="error">Error loading burg lore files. Make sure you\'re running this from the LoreGen directory.</div>';
                document.getElementById('states').innerHTML = '<div class="error">Error loading state lore files. Make sure you\'re running this from the LoreGen directory.</div>';
            }
        }

        async function fetchLoreFiles(type) {
            const files = [];
            let id = 1;
            
            while (true) {
                try {
                    const response = await fetch(`lore/${type}/${id}.json`);
                    if (response.ok) {
                        const data = await response.json();
                        files.push(data);
                        id++;
                    } else {
                        break;
                    }
                } catch (error) {
                    break;
                }
            }
            
            return files;
        }

        function renderLoreSection(sectionId, files) {
            const section = document.getElementById(sectionId);
            
            if (files.length === 0) {
                section.innerHTML = '<div class="empty-state"><h3>No Lore Files Found</h3><p>Generate some lore first using the npm scripts.</p></div>';
                return;
            }

            section.innerHTML = files.map(file => renderLoreItem(file)).join('');
        }

        function renderLoreItem(item) {
            const type = item.entity.type;
            const id = item.entity.id;
            
            let content = `
                <div class="lore-item">
                    <div class="lore-header">
                        <div class="lore-title">${getEntityName(item)}</div>
                        <div class="lore-id">${type.toUpperCase()} #${id}</div>
                    </div>
            `;

            if (item.summary) {
                content += `
                    <div class="lore-content">
                        <h3>Summary</h3>
                        <p>${item.summary}</p>
                    </div>
                `;
            }

            if (item.factions && item.factions.length > 0) {
                content += `
                    <div class="factions">
                        <h3>Factions</h3>
                        ${item.factions.map(faction => `
                            <div class="faction">
                                <h4>${faction.name}</h4>
                                <p><strong>Motive:</strong> ${faction.motive}</p>
                                <p><strong>Strength:</strong> ${faction.strength}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (item.notables && item.notables.length > 0) {
                content += `
                    <div class="notables">
                        <h3>Notable People</h3>
                        ${item.notables.map(notable => `
                            <div class="notable">
                                <h4>${notable.name}</h4>
                                <p><strong>Role:</strong> ${notable.role}</p>
                                <div class="secret"><strong>Secret:</strong> ${notable.secret}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (item.adventureHooks && item.adventureHooks.length > 0) {
                content += `
                    <div class="adventure-hooks">
                        <h3>Adventure Hooks</h3>
                        ${item.adventureHooks.map(hook => `
                            <div class="hook">
                                <h4>${hook.title}</h4>
                                <p><strong>Setup:</strong> ${hook.setup}</p>
                                <p><strong>Complication:</strong> ${hook.complication}</p>
                                <p><strong>Reward:</strong> ${hook.reward}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (item.history && item.history.length > 0) {
                content += `
                    <div class="lore-content">
                        <h3>History</h3>
                        ${item.history.map(event => `<p>${event}</p>`).join('')}
                    </div>
                `;
            }

            // Add metadata
            content += `
                <div class="metadata">
                    <strong>Generated:</strong> ${item.lastGeneratedAt ? new Date(item.lastGeneratedAt).toLocaleString() : 'Unknown'} |
                    <strong>Hash:</strong> ${item.hashOfInputs ? item.hashOfInputs.substring(0, 8) + '...' : 'N/A'}
                </div>
            `;

            content += '</div>';
            return content;
        }

        function getEntityName(item) {
            // Try to get name from facts or use a default
            if (item.facts && item.facts.burg && item.facts.burg.name) {
                return item.facts.burg.name;
            }
            if (item.facts && item.facts.state && item.facts.state.name) {
                return item.facts.state.name;
            }
            return `${item.entity.type.charAt(0).toUpperCase() + item.entity.type.slice(1)} ${item.entity.id}`;
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.lore-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Load lore files when page loads
        document.addEventListener('DOMContentLoaded', loadLoreFiles);
    </script>
</body>
</html>
